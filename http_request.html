<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.min.js"></script>
<script type="text/javascript">

$(function() {

    let ajaxPrefProp = {
        url:'/ajaxpost.php',
        type:'POST',
        //正しくはContent-TypeとdataTypeを設定しないと自動判定して飛んでします
        contentType: 'application/json',
        data:JSON.stringify({
            'user_id':'aaaa',
            'password':'bbbb'
        })
    }
    //jqueryAjax
    function jqueryAjax() {
        $.ajax(ajaxPrefProp)
          .done((data) => {
            console.log("--jqueryAjax success--");
            console.log(data)
          })
          .fail((err) => {
            console.log("--jqueryAjax fail--");
            console.log(err)
          })
          .always((data) =>{
            console.log("--jqueryAjax end--");
            console.log(data);
          })
    }

    //fetch
    function fetchApi() {

        let url = '/ajaxpost.php';

        return fetch(url,{
            method:'POST',
            headers: {
             "Content-Type": "application/json"
            },
            body: JSON.stringify({
                'user_id':'aaaa',
                'password':'bbbb'
            })
        })
        .then((res) => {
            console.log('--fetch 1段目then--')
            return res.json();
        })

    }

    //axios
    function axiosApi() {
        let url = '/ajaxpost.php';

        return axios.post(url,{
            'user_id':'aaaa',
            'password':'bbbb'
        })
    }

    console.log("--jqueryAjax start--");
    jqueryAjax()

    console.log("--fetch start--");
    fetchApi().then((res) => {
        //resolve時ここにくる
        console.log('--fetch 2段目(resolve)then--')
        console.log(JSON.stringify(res))
    })
    .catch((err) => {
        //reject時ここにくる
        console.log("--fetch 2段目(reject) err end--")
        console.log(err)
    }).finally((data) =>{
        console.log('--fetch always--');
    });

    async function getPrefProcessFetch() {
        try{
            console.log("fetch_await start")
            const result =  await fetchApi();
            console.log(result)
            console.log("fetch_await get")
        } catch(error) {
            console.log('fetch_await error');
            console.log(error)
        } finally {
            console.info('fetch_await finally');
        }
    }
    getPrefProcessFetch()

    console.log("--axios start--");

    axiosApi()
    .then((data) => {
        //resolve時ここにくる
        console.log('--axios then--')
        console.log(data)
    })
    .catch((err) => {
        //普通の404、500エラー
        console.log('--axios error--')
        console.log(err);
    })
    .finally((data) => {
        //dataはない
        console.log('--axios always--');
    });


    async function getPrefProcess() {
        try{
            console.log("axios start")
            const result =  await axiosApi();
            console.log(result)
            console.log("axios get")
        } catch(error) {
            console.log('axios error');
            console.log(error)
        } finally {
            console.info('axios finally');
        }
    }
    getPrefProcess()
})
</script>
<body>
  <div style="max-width: 900px; margin: 0 auto; padding: 20px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica', 'Arial', sans-serif; line-height: 1.6;">
    <h1 style="border-bottom: 2px solid #ddd; padding-bottom: 10px;">HTTPリクエストの実装パターン比較</h1>
    
    <p style="background-color: #fff3cd; padding: 10px; border-radius: 5px;">
      <strong>Console</strong>をチェック（ajax_matomeも参考に！）
    </p>

    <h2 style="color: #0366d6; margin-top: 30px;">このサンプルで学べること</h2>
    <ul>
      <li>3つの主要なHTTPリクエスト方法の比較</li>
      <li>jQuery Ajax / Fetch API / Axios の使い方</li>
      <li>それぞれのPromise処理とAsync/Await対応</li>
      <li>エラーハンドリングの違い</li>
    </ul>

    <h2 style="color: #0366d6; margin-top: 30px;">共通のリクエストデータ</h2>
    <pre style="background-color: #f6f8fa; padding: 16px; border-radius: 6px; overflow-x: auto;"><code>{
    url: '/ajaxpost.php',
    method: 'POST',
    contentType: 'application/json',
    data: {
        'user_id': 'aaaa',
        'password': 'bbbb'
    }
}</code></pre>

    <h2 style="color: #0366d6; margin-top: 30px;">1. jQuery Ajax - 従来の方法</h2>
    <pre style="background-color: #f6f8fa; padding: 16px; border-radius: 6px; overflow-x: auto;"><code>function jqueryAjax() {
    $.ajax({
        url: '/ajaxpost.php',
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({...})
    })
    .done((data) => {
        // 成功時の処理
    })
    .fail((err) => {
        // 失敗時の処理
    })
    .always((data) => {
        // 常に実行される処理
    })
}</code></pre>
    <p><strong>特徴：</strong></p>
    <ul>
      <li>jQuery が必要</li>
      <li><code>done</code>, <code>fail</code>, <code>always</code> メソッドを使用</li>
      <li><code>Content-Type</code>と<code>dataType</code>を設定しないと自動判定される</li>
      <li>JSONデータは<code>JSON.stringify()</code>で文字列化が必要</li>
      <li>古いブラウザでも動作する（互換性が高い）</li>
      <li>Async/Awaitとの相性は△（Promiseラッパーが必要）</li>
    </ul>

    <h2 style="color: #0366d6; margin-top: 30px;">2. Fetch API - ブラウザ標準</h2>
    <pre style="background-color: #f6f8fa; padding: 16px; border-radius: 6px; overflow-x: auto;"><code>function fetchApi() {
    return fetch('/ajaxpost.php', {
        method: 'POST',
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({...})
    })
    .then((res) => {
        // レスポンスオブジェクトを受け取る
        return res.json();  // JSON解析（これもPromiseを返す）
    })
}

// 使い方1: Promiseチェーン
fetchApi()
.then((res) => {
    // JSONデータを受け取る
})
.catch((err) => {
    // エラー処理
})
.finally(() => {
    // 常に実行
})

// 使い方2: Async/Await
async function getPrefProcessFetch() {
    try {
        const result = await fetchApi();
        console.log(result);
    } catch(error) {
        console.log(error);
    } finally {
        console.log('finally');
    }
}</code></pre>
    <p><strong>特徴：</strong></p>
    <ul>
      <li><strong>ライブラリ不要</strong>（ブラウザ標準API）</li>
      <li>Promiseベースで、<code>then/catch/finally</code>が使える</li>
      <li><strong>2段階の処理が必要</strong>：
        <ul>
          <li>1段目: レスポンスオブジェクトを取得（<code>fetch()</code>）</li>
          <li>2段目: JSONデータを取得（<code>res.json()</code>）</li>
        </ul>
      </li>
      <li>Async/Awaitと相性が良い</li>
      <li>注意: HTTPエラー（404, 500など）でも<code>reject</code>されない（<code>res.ok</code>で判定が必要）</li>
      <li>モダンなブラウザで使用可能</li>
    </ul>

    <h2 style="color: #0366d6; margin-top: 30px;">3. Axios - 人気のライブラリ</h2>
    <pre style="background-color: #f6f8fa; padding: 16px; border-radius: 6px; overflow-x: auto;"><code>function axiosApi() {
    return axios.post('/ajaxpost.php', {
        'user_id': 'aaaa',
        'password': 'bbbb'
    })
}

// 使い方1: Promiseチェーン
axiosApi()
.then((data) => {
    // 成功時の処理
})
.catch((err) => {
    // エラー処理（404, 500エラーなど）
})
.finally(() => {
    // 常に実行（dataは渡されない）
})

// 使い方2: Async/Await
async function getPrefProcess() {
    try {
        const result = await axiosApi();
        console.log(result);
    } catch(error) {
        console.log(error);
    } finally {
        console.log('finally');
    }
}</code></pre>
    <p><strong>特徴：</strong></p>
    <ul>
      <li>外部ライブラリ（CDNまたはnpm install が必要）</li>
      <li><strong>最もシンプルな記述</strong>（Content-Typeの自動設定、JSON自動変換）</li>
      <li>JSONデータは<strong>自動的にパース</strong>される</li>
      <li><code>JSON.stringify()</code>が不要</li>
      <li>HTTPエラー（404, 500など）で自動的に<code>reject</code>される</li>
      <li>Async/Awaitと相性が良い</li>
      <li>レスポンスインターセプター、リクエストインターセプターなどの高度な機能</li>
      <li><strong>現代の開発で最も人気</strong></li>
    </ul>

    <h2 style="color: #0366d6; margin-top: 30px;">Fetch API の2段階処理について</h2>
    <p style="padding: 15px; background-color: #e7f3ff; border-left: 4px solid #0366d6; border-radius: 4px;">
      Fetchは<strong>2回のPromise処理</strong>が必要です：
    </p>
    <pre style="background-color: #f6f8fa; padding: 16px; border-radius: 6px; overflow-x: auto;"><code>fetch(url)
    .then((res) => {
        // 1段目: HTTPレスポンスオブジェクト（ヘッダー情報など）
        console.log(res.status);  // 200, 404など
        return res.json();  // ← これもPromiseを返す
    })
    .then((data) => {
        // 2段目: 実際のJSONデータ
        console.log(data);
    })</code></pre>

    <h2 style="color: #0366d6; margin-top: 30px;">Async/Await の使い方</h2>
    <p>3つのライブラリすべてで Async/Await が使えます：</p>
    <pre style="background-color: #f6f8fa; padding: 16px; border-radius: 6px; overflow-x: auto;"><code>async function getData() {
    try {
        // Promiseを返す関数なら何でもawaitできる
        const result = await fetchApi();      // Fetch
        const result = await axiosApi();      // Axios
        const result = await $.ajax({...});   // jQuery
        
        console.log(result);
    } catch(error) {
        // エラー処理
    } finally {
        // 常に実行
    }
}</code></pre>

    <h2 style="color: #0366d6; margin-top: 30px;">比較表</h2>
    <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
      <thead>
        <tr style="background-color: #f6f8fa;">
          <th style="border: 1px solid #ddd; padding: 10px; text-align: left;">項目</th>
          <th style="border: 1px solid #ddd; padding: 10px; text-align: left;">jQuery Ajax</th>
          <th style="border: 1px solid #ddd; padding: 10px; text-align: left;">Fetch API</th>
          <th style="border: 1px solid #ddd; padding: 10px; text-align: left;">Axios</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td style="border: 1px solid #ddd; padding: 10px;"><strong>依存関係</strong></td>
          <td style="border: 1px solid #ddd; padding: 10px;">jQuery必須</td>
          <td style="border: 1px solid #ddd; padding: 10px;">なし（標準API）</td>
          <td style="border: 1px solid #ddd; padding: 10px;">ライブラリ必須</td>
        </tr>
        <tr>
          <td style="border: 1px solid #ddd; padding: 10px;"><strong>記述のシンプルさ</strong></td>
          <td style="border: 1px solid #ddd; padding: 10px;">△</td>
          <td style="border: 1px solid #ddd; padding: 10px;">△（2段階必要）</td>
          <td style="border: 1px solid #ddd; padding: 10px;">◎</td>
        </tr>
        <tr>
          <td style="border: 1px solid #ddd; padding: 10px;"><strong>JSON自動変換</strong></td>
          <td style="border: 1px solid #ddd; padding: 10px;">△</td>
          <td style="border: 1px solid #ddd; padding: 10px;">×（手動）</td>
          <td style="border: 1px solid #ddd; padding: 10px;">◎（自動）</td>
        </tr>
        <tr>
          <td style="border: 1px solid #ddd; padding: 10px;"><strong>HTTPエラー処理</strong></td>
          <td style="border: 1px solid #ddd; padding: 10px;">◎</td>
          <td style="border: 1px solid #ddd; padding: 10px;">△（要手動判定）</td>
          <td style="border: 1px solid #ddd; padding: 10px;">◎</td>
        </tr>
        <tr>
          <td style="border: 1px solid #ddd; padding: 10px;"><strong>Async/Await</strong></td>
          <td style="border: 1px solid #ddd; padding: 10px;">△</td>
          <td style="border: 1px solid #ddd; padding: 10px;">◎</td>
          <td style="border: 1px solid #ddd; padding: 10px;">◎</td>
        </tr>
        <tr>
          <td style="border: 1px solid #ddd; padding: 10px;"><strong>ブラウザ互換性</strong></td>
          <td style="border: 1px solid #ddd; padding: 10px;">◎（IE対応）</td>
          <td style="border: 1px solid #ddd; padding: 10px;">△（古いIE不可）</td>
          <td style="border: 1px solid #ddd; padding: 10px;">◎</td>
        </tr>
        <tr>
          <td style="border: 1px solid #ddd; padding: 10px;"><strong>推奨度</strong></td>
          <td style="border: 1px solid #ddd; padding: 10px;">レガシー</td>
          <td style="border: 1px solid #ddd; padding: 10px;">標準的</td>
          <td style="border: 1px solid #ddd; padding: 10px;">最推奨</td>
        </tr>
      </tbody>
    </table>

    <h2 style="color: #0366d6; margin-top: 30px;">まとめ</h2>
    <ul>
      <li><strong>jQuery Ajax</strong>: 古いプロジェクトやレガシーブラウザ対応が必要な場合</li>
      <li><strong>Fetch API</strong>: ライブラリを増やしたくない、標準APIを使いたい場合</li>
      <li><strong>Axios</strong>: 新規プロジェクトや、シンプルで強力なHTTPクライアントが欲しい場合（<strong>最推奨</strong>）</li>
    </ul>

    <p style="margin-top: 20px; padding: 15px; background-color: #d4edda; border-left: 4px solid #28a745; border-radius: 4px;">
      <strong>💡 2025年の推奨：</strong><br>
      新規開発では <strong>Axios</strong> が最も推奨されます。シンプルで直感的、エラーハンドリングも優秀です。<br>
      ライブラリを追加したくない場合は <strong>Fetch API</strong> を使いましょう。
    </p>
  </div>
</body>
</html>
