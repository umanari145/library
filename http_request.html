<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.2/axios.min.js"></script>
<script type="text/javascript">

$(function() {

    let ajaxPrefProp = {
        url:'/ajaxpost.php',
        type:'POST',
        //正しくはContent-TypeとdataTypeを設定しないと自動判定して飛んでします
        contentType: 'application/json',
        data:JSON.stringify({
            'user_id':'aaaa',
            'password':'bbbb'
        })
    }
    //jqueryAjax
    function jqueryAjax() {
        $.ajax(ajaxPrefProp)
          .done((data) => {
            console.log("--jqueryAjax success--");
            console.log(data)
          })
          .fail((err) => {
            console.log("--jqueryAjax fail--");
            console.log(err)
          })
          .always((data) =>{
            console.log("--jqueryAjax end--");
            console.log(data);
          })
    }

    //fetch
    function fetchApi() {

        let url = '/ajaxpost.php';

        return fetch(url,{
            method:'POST',
            headers: {
             "Content-Type": "application/json"
            },
            body: JSON.stringify({
                'user_id':'aaaa',
                'password':'bbbb'
            })
        })
        .then((res) => {
            console.log('--fetch 1段目then--')
            return res.json();
        })

    }

    //axios
    function axiosApi() {
        let url = '/ajaxpost.php';

        return axios.post(url,{
            'user_id':'aaaa',
            'password':'bbbb'
        })
    }

    console.log("--jqueryAjax start--");
    jqueryAjax()

    console.log("--fetch start--");
    fetchApi().then((res) => {
        //resolve時ここにくる
        console.log('--fetch 2段目(resolve)then--')
        console.log(JSON.stringify(res))
    })
    .catch((err) => {
        //reject時ここにくる
        console.log("--fetch 2段目(reject) err end--")
        console.log(err)
    }).finally((data) =>{
        console.log('--fetch always--');
    });

    async function getPrefProcessFetch() {
        try{
            console.log("fetch_await start")
            const result =  await fetchApi();
            console.log(result)
            console.log("fetch_await get")
        } catch(error) {
            console.log('fetch_await error');
            console.log(error)
        } finally {
            console.info('fetch_await finally');
        }
    }
    getPrefProcessFetch()

    console.log("--axios start--");

    axiosApi()
    .then((data) => {
        //resolve時ここにくる
        console.log('--axios then--')
        console.log(data)
    })
    .catch((err) => {
        //普通の404、500エラー
        console.log('--axios error--')
        console.log(err);
    })
    .finally((data) => {
        //dataはない
        console.log('--axios always--');
    });


    async function getPrefProcess() {
        try{
            console.log("axios start")
            const result =  await axiosApi();
            console.log(result)
            console.log("axios get")
        } catch(error) {
            console.log('axios error');
            console.log(error)
        } finally {
            console.info('axios finally');
        }
    }
    getPrefProcess()
})
</script>
<body>
    consoleをチェック(ajax_matomeも参考に！)
</body>
</html>
